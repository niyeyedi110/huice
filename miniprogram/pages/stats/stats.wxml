<!--pages/stats/stats.wxml-->
<view class="container">
  <!-- æ—¶é—´èŒƒå›´é€‰æ‹© -->
  <view class="time-range-selector">
    <view wx:for="{{timeRanges}}" wx:key="value" 
          class="range-btn {{timeRange === item.value ? 'active' : ''}}"
          bindtap="selectTimeRange" data-value="{{item.value}}">
      {{item.label}}
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading">
    <text>ç»Ÿè®¡æ•°æ®åŠ è½½ä¸­...</text>
  </view>

  <!-- ç»Ÿè®¡å†…å®¹ -->
  <view wx:else class="stats-content">
    <!-- åŸºç¡€ç»Ÿè®¡ -->
    <view class="stats-card card">
      <view class="card-title">è®°å½•æ¦‚è§ˆ</view>
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-value">{{stats.totalDays}}</text>
          <text class="stat-label">è®°å½•å¤©æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{stats.totalRecords}}</text>
          <text class="stat-label">æ€»è®°å½•æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{stats.continuousDays}}</text>
          <text class="stat-label">è¿ç»­å¤©æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{stats.completionRate}}%</text>
          <text class="stat-label">å®Œæˆç‡</text>
        </view>
      </view>
    </view>

    <!-- é¤æ¬¡åˆ†å¸ƒ -->
    <view class="stats-card card">
      <view class="card-title">é¤æ¬¡åˆ†å¸ƒ</view>
      <view class="meal-distribution">
        <view class="meal-item">
          <view class="meal-icon">ğŸŒ…</view>
          <text class="meal-name">æ—©é¤</text>
          <text class="meal-count">{{stats.mealDistribution.breakfast}}æ¬¡</text>
          <view class="meal-bar" style="width: {{stats.mealDistribution.breakfast / stats.totalRecords * 100}}%"></view>
        </view>
        <view class="meal-item">
          <view class="meal-icon">â˜€ï¸</view>
          <text class="meal-name">åˆé¤</text>
          <text class="meal-count">{{stats.mealDistribution.lunch}}æ¬¡</text>
          <view class="meal-bar" style="width: {{stats.mealDistribution.lunch / stats.totalRecords * 100}}%"></view>
        </view>
        <view class="meal-item">
          <view class="meal-icon">ğŸŒ™</view>
          <text class="meal-name">æ™šé¤</text>
          <text class="meal-count">{{stats.mealDistribution.dinner}}æ¬¡</text>
          <view class="meal-bar" style="width: {{stats.mealDistribution.dinner / stats.totalRecords * 100}}%"></view>
        </view>
        <view class="meal-item">
          <view class="meal-icon">ğŸ¿</view>
          <text class="meal-name">åŠ é¤</text>
          <text class="meal-count">{{stats.mealDistribution.snack}}æ¬¡</text>
          <view class="meal-bar" style="width: {{stats.mealDistribution.snack / stats.totalRecords * 100}}%"></view>
        </view>
      </view>
    </view>

    <!-- çƒ­é‡åˆ†å¸ƒ -->
    <view class="stats-card card">
      <view class="card-title">çƒ­é‡åˆ†å¸ƒ</view>
      <view class="calorie-distribution">
        <view class="calorie-item">
          <view class="calorie-circle" style="background-color: #4CAF50;">
            <text class="calorie-percent">{{stats.calorieDistribution.low}}%</text>
          </view>
          <text class="calorie-label">ä½çƒ­é‡</text>
        </view>
        <view class="calorie-item">
          <view class="calorie-circle" style="background-color: #FF9800;">
            <text class="calorie-percent">{{stats.calorieDistribution.medium}}%</text>
          </view>
          <text class="calorie-label">ä¸­çƒ­é‡</text>
        </view>
        <view class="calorie-item">
          <view class="calorie-circle" style="background-color: #F44336;">
            <text class="calorie-percent">{{stats.calorieDistribution.high}}%</text>
          </view>
          <text class="calorie-label">é«˜çƒ­é‡</text>
        </view>
      </view>
    </view>

    <!-- å¸¸ç”¨æ ‡ç­¾ -->
    <view class="stats-card card">
      <view class="card-title">å¸¸ç”¨æ ‡ç­¾</view>
      <view class="tags-cloud">
        <view wx:for="{{stats.mostUsedTags}}" wx:key="name" 
              class="tag-item" bindtap="viewTagDetail" data-tag="{{item}}"
              style="font-size: {{24 + item.count * 2}}rpx;">
          {{item.name}}
        </view>
      </view>
      <view wx:if="{{stats.mostUsedTags.length === 0}}" class="empty-tags">
        <text>æš‚æ— æ ‡ç­¾æ•°æ®</text>
      </view>
    </view>

    <!-- ç”ŸæˆæŠ¥å‘ŠæŒ‰é’® -->
    <view class="report-section">
      <button class="report-btn" bindtap="generateReport">
        ç”Ÿæˆé¥®é£ŸæŠ¥å‘Š
      </button>
    </view>
  </view>
</view>