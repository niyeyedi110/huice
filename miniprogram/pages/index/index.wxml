<!--pages/index/index.wxml-->
<view class="container fade-in">
  <!-- é¡¶éƒ¨æ—¥æœŸ -->
  <view class="header">
    <view class="date-section">
      <text class="date-weekday">{{weekday}}</text>
      <text class="date-text">{{todayDate}}</text>
    </view>
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-number">{{todayRecords.length}}</text>
        <text class="stat-label">ä»Šæ—¥é¤æ•°</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-number">{{todayPhotos}}</text>
        <text class="stat-label">ä»Šæ—¥ç…§ç‰‡</text>
      </view>
    </view>
  </view>

  <!-- æ‹ç…§æŒ‰é’®åŒºåŸŸ -->
  <view class="camera-section">
    <view class="camera-button slide-up" bindtap="quickCamera">
      <view class="camera-icon">ğŸ“·</view>
      <text class="camera-text">æ‹ç…§è®°å½•</text>
      <view class="camera-hint">å¿«é€Ÿè®°å½•è¿™ä¸€é¤</view>
    </view>
    <view class="sub-actions">
      <view class="sub-action" bindtap="goToCamera">
        <text class="sub-icon">ğŸ–¼ï¸</text>
        <text class="sub-text">ç›¸å†Œé€‰æ‹©</text>
      </view>
      <view class="sub-action" bindtap="quickNote">
        <text class="sub-icon">âœï¸</text>
        <text class="sub-text">å¿«é€Ÿå¤‡æ³¨</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥è®°å½• -->
  <view class="records-section">
    <view class="section-title">
      <text>ä»Šæ—¥é¥®é£Ÿ</text>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="loading">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{showEmpty}}" class="empty-state">
      <text class="empty-icon">ğŸ½ï¸</text>
      <text class="empty-title">ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•</text>
      <text class="empty-text">è®°å½•ä½ çš„æ¯ä¸€é¤ï¼Œå…»æˆå¥åº·é¥®é£Ÿä¹ æƒ¯</text>
      <view class="btn btn-primary mt-40" bindtap="quickCamera">
        <text>å¼€å§‹è®°å½•</text>
      </view>
    </view>

    <!-- è®°å½•åˆ—è¡¨ -->
    <view wx:else class="records-list">
      <view wx:for="{{todayRecords}}" wx:key="_id" class="record-item card fade-in" style="animation-delay: {{index * 0.1}}s">
        <view class="record-header">
          <view class="meal-type">
            <view class="meal-badge {{item.mealType}}">
              <text class="meal-icon">{{mealIcons[item.mealType]}}</text>
              <text class="meal-label">{{mealTypes[item.mealType]}}</text>
            </view>
            <text class="meal-time">{{item.createTime}}</text>
          </view>
          <text class="more-icon" bindtap="showActions" data-id="{{item._id}}">â‹®</text>
        </view>
        
        <view class="record-photos {{item.photos.length === 1 ? 'single-photo' : ''}} {{item.photos.length === 2 ? 'double-photo' : ''}}" bindtap="viewRecord" data-record="{{item}}">
          <image wx:for="{{item.photos}}" wx:for-item="photo" wx:key="*this" 
                 src="{{photo}}" class="record-photo" mode="aspectFill"></image>
        </view>

        <view wx:if="{{item.tags && item.tags.length > 0}}" class="record-tags">
          <text wx:for="{{item.tags}}" wx:key="*this" class="tag">{{item}}</text>
        </view>

        <view wx:if="{{item.description}}" class="record-desc">
          <text>{{item.description}}</text>
        </view>
        
        <!-- è¥å…»ä¿¡æ¯ -->
        <view wx:if="{{item.nutrition}}" class="nutrition-summary">
          <text class="nutrition-title">ğŸ”¬ è¥å…»æˆåˆ†</text>
          <view class="nutrition-badges">
            <view class="nutrition-badge calories">
              <text class="badge-value">{{item.nutrition.totalNutrition.calories}}</text>
              <text class="badge-label">åƒå¡</text>
            </view>
            <view class="nutrition-badge protein">
              <text class="badge-value">{{item.nutrition.totalNutrition.protein}}</text>
              <text class="badge-label">gè›‹ç™½è´¨</text>
            </view>
            <view class="nutrition-badge carbs">
              <text class="badge-value">{{item.nutrition.totalNutrition.carbs}}</text>
              <text class="badge-label">gç¢³æ°´</text>
            </view>
          </view>
        </view>

        <view class="record-footer">
          <view class="satisfaction">
            <text class="emoji-icon">{{satisfactionEmojis[item.satisfaction - 1]}}</text>
            <text class="satisfaction-text">{{satisfactionTexts[item.satisfaction - 1]}}</text>
          </view>
          <view wx:if="{{item.location}}" class="location">
            <text class="location-icon">ğŸ“</text>
            <text>{{item.location}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>